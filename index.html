<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Captcha Canvas Arcade with API</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
  * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Press Start 2P', monospace; }
  body { display: flex; flex-direction: column; align-items: center; min-height: 100vh; background: #0a0a0a; color: #0ff; padding: 36px; font-size: 1.32rem; }
  h1 { margin-bottom: 60px; font-size: 2.64rem; color: #0ff; text-shadow: 0 0 5px #0ff; }

  .captcha-container { display: flex; flex-direction: column; align-items: center; margin-bottom: 36px; position: relative; transform: scale(1.2); }
  canvas { border: 3px solid #0ff; border-radius: 12px; background:#111; margin-bottom: 12px; }

  .loading-overlay {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 60%;
    display: flex; align-items: center; justify-content: center;
    background: rgba(0,0,0,0.7); color: #0ff;
    font-size: 1.44rem; letter-spacing: 1px;
    border-radius: 12px;
    display: none;
  }
  .loading-overlay.active { display: flex; animation: pulse 1s infinite alternate; }
  @keyframes pulse { 0% {opacity:0.5;} 100% {opacity:1;} }

  input { padding: 14px; font-size: 1.2rem; border: 2px solid #0ff; border-radius: 6px; width: 384px; margin-bottom: 14px; background: #111; color: #0ff; text-align: center; transition: all 0.2s ease; }
  input:focus { outline: none; border-color: purple; box-shadow: 0 0 5px #ff0; }

  button { padding: 14px 30px; font-size: 1.2rem; border: none; border-radius: 6px; background: #1ABC9C; color: #111; cursor: pointer; transition: all 0.2s ease; text-transform: uppercase; letter-spacing: 1px; width: 100%; max-width: 384px; }
  button:hover { background: red; }

  .stats { margin-top: 30px; display: grid; grid-template-columns: repeat(auto-fit, minmax(192px, 1fr)); gap: 14px; width: 100%; max-width: 900px; }
  .stat { background: rgba(0,255,255,0.1); padding: 18px; border-radius: 10px; text-align: center; box-shadow: 0 0 5px #0ff; color: #0ff; }
  .stat span { font-size: 1.56rem; display: block; font-weight: bold; text-shadow: 0 0 3px #0ff; }
</style>
</head>
<body>

<h1>Solve the Captcha</h1>

<div class="captcha-container">
  <canvas id="captchaCanvas" width="320" height="160"></canvas>
  <div class="loading-overlay" id="loading">LOADING...</div>
  <input type="text" id="captchaInput" placeholder="Enter captcha here" autofocus>
  <button id="skipBtn">Skip</button>
</div>

<div class="stats">
  <div class="stat">Total<br><span id="total">0</span></div>
  <div class="stat">Correct<br><span id="correct">0</span></div>
  <div class="stat">Wrong<br><span id="wrong">0</span></div>
  <div class="stat">Skipped<br><span id="skipped">0</span></div>
  <div class="stat">Success Rate<br><span id="success">0%</span></div>
  <div class="stat">Chars typed<br><span id="chars">0</span></div>
</div>

<script>
const canvas = document.getElementById('captchaCanvas');
const ctx = canvas.getContext('2d');
const captchaInput = document.getElementById('captchaInput');
const skipBtn = document.getElementById('skipBtn');
const loadingOverlay = document.getElementById('loading');

let stats = JSON.parse(localStorage.getItem('captchaStats')) || { total:0, correct:0, wrong:0, skipped:0, chars:0 };
let currentCaptcha = '';
let currentCaptchaImg = null;

function generateRandomText(length=5){
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
  let text='';
  for(let i=0;i<length;i++) text+=chars.charAt(Math.floor(Math.random()*chars.length));
  return text;
}

async function fetchCaptcha(text){
  loadingOverlay.classList.add('active');
  try {
    const response = await fetch('https://api.opencaptcha.io/captcha', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({text})
    });
    const blob = await response.blob();
    const img = new Image();
    const url = URL.createObjectURL(blob);
    await new Promise(resolve => { img.onload = resolve; img.src = url; });
    return img;
  } finally {
    loadingOverlay.classList.remove('active');
  }
}

async function drawCaptchaFromAPI(text){
  currentCaptchaImg = await fetchCaptcha(text);
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(currentCaptchaImg, 0, 0, canvas.width, canvas.height);
}

function drawFeedbackOverlay(isCorrect){
  ctx.drawImage(currentCaptchaImg,0,0,canvas.width,canvas.height);
  ctx.fillStyle = isCorrect ? 'rgba(0,255,0,0.5)' : 'rgba(255,0,0,0.5)';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = '#fff';
  ctx.font = '100px monospace';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(isCorrect ? '✔' : '✖', canvas.width/2, canvas.height/2);
  setTimeout(()=>{
    if(currentCaptchaImg) ctx.drawImage(currentCaptchaImg,0,0,canvas.width,canvas.height);
  }, 400);
}

async function loadNewCaptcha(){
  currentCaptcha = generateRandomText();
  await drawCaptchaFromAPI(currentCaptcha);
  captchaInput.value='';
  updateStats();
  captchaInput.focus();
}

function updateStats(){
  document.getElementById('total').textContent = stats.total;
  document.getElementById('correct').textContent = stats.correct;
  document.getElementById('wrong').textContent = stats.wrong;
  document.getElementById('skipped').textContent = stats.skipped;
  document.getElementById('success').textContent = (stats.total===0?0:((stats.correct/stats.total*100).toFixed(1)))+'%';
  document.getElementById('chars').textContent = stats.chars;
  localStorage.setItem('captchaStats', JSON.stringify(stats));
}

let previousValue = '';

captchaInput.addEventListener('input', () => {
  const currentValue = captchaInput.value;

  // Only count if a new character was added
  if (currentValue.length > previousValue.length) {
    stats.chars++;
    updateStats();
  }

  previousValue = currentValue; // Update previous value
});


captchaInput.addEventListener('keyup',(e)=>{if(e.key==='Enter') checkCaptcha();});

async function checkCaptcha(){
  const userInput = captchaInput.value.trim();
  stats.total++;
  if(userInput===currentCaptcha){
    stats.correct++;
    drawFeedbackOverlay(true);
    updateStats();
    setTimeout(loadNewCaptcha,500);
  } else {
    stats.wrong++;
    drawFeedbackOverlay(false);
    updateStats();
  }
}

skipBtn.addEventListener('click',()=>{
  stats.skipped++;
  stats.total++;
  updateStats();
  loadNewCaptcha();
});

loadNewCaptcha();
</script>

</body>
</html>
